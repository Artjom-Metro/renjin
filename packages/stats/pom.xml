<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <parent>
    <artifactId>renjin-packages</artifactId>
    <groupId>org.renjin</groupId>
    <version>0.9.0-SNAPSHOT</version>
    <relativePath>../pom.xml</relativePath>
  </parent>
  <artifactId>stats</artifactId>
  <description>R statistical functions</description>
  <licenses>
    <license>
      <name>Part of R 2.14.2</name>
    </license>
  </licenses>
  <developers>
    <developer>
      <name>R Development Core Team and contributors worldwide</name>
    </developer>
  </developers>
  <dependencies>
    <dependency>
      <groupId>org.renjin</groupId>
      <artifactId>renjin-core</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.renjin</groupId>
      <artifactId>renjin-nmath</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.renjin</groupId>
      <artifactId>renjin-appl</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.renjin</groupId>
      <artifactId>renjin-gnur-runtime</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.renjin</groupId>
      <artifactId>graphics</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.renjin</groupId>
      <artifactId>utils</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.renjin</groupId>
      <artifactId>hamcrest</artifactId>
      <version>${project.version}</version>
      <scope>test</scope>
    </dependency>
  </dependencies>
  <build>
    <plugins>
      <plugin>
        <groupId>org.renjin</groupId>
        <artifactId>renjin-maven-plugin</artifactId>
        <version>${project.version}</version>
        <executions>
          <execution>
            <id>compile-c-sources</id>
            <goals>
              <goal>gnur-sources-compile</goal>
            </goals>
            <phase>compile</phase>
          </execution>
          <execution>
            <id>build</id>
            <goals>
              <goal>namespace-compile</goal>
            </goals>
            <phase>process-classes</phase>
          </execution>
          <execution>
            <id>test</id>
            <goals>
              <goal>test</goal>
            </goals>
            <phase>test</phase>
            <configuration>
              <defaultPackages>
                <package>grDevices</package>
                <package>stats</package>
              </defaultPackages>

              <!-- Allow up to 500k of output per test -->
              <outputLimit>512000</outputLimit>
            </configuration>
          </execution>
        </executions>
      </plugin>
      
      <!-- Currently the GCC-Bridge compiler can generate some really big classfiles
           whose size prevents the JIT compiler from kicking in. Here we really need 
           a better optimization pass to improve the final bytecode. 
           
           Soot is of course designed to do this, but doesn't yet handle MethodHandle 
           constants, which means we can't use it on all classfiles yet. 
           
           Here we apply to just a few specific classes on an experimental basis to
           fix a few major performance regressions
           
           -->
           
      <plugin>
        <groupId>org.renjin</groupId>
        <artifactId>gcc-bridge-maven-plugin</artifactId>
        <version>${project.version}</version>
        <executions>
          <execution>
            <goals>
              <goal>soot</goal>
            </goals>
            <phase>process-classes</phase>
            <configuration>
              <optimize>
                <class>org.renjin.stats.fft__</class>
                <class>org.renjin.stats.kmns__</class>
                <class>org.renjin.stats.hclust__</class>
              </optimize>
            </configuration>
          </execution>
        </executions>
      </plugin>
    </plugins>
  </build>
</project>
