
# Test for consistency of renjin generated pseudo random numbers.
# Desired output is not generated by the original interpreter.

library(hamcrest)

DELTA <- 0.01

test.RNGkind <- function() {
	k <- RNGkind('Mersenne-Twister', 'Inversion')
	assertThat(k, equalTo(c("Mersenne-Twister", "Inversion")))
}

test.runif <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(runif(1,0,2), closeTo(1.859, 0.01))
	assertThat(mean(runif(100000,0,2)), closeTo(1.00, 0.01))
}


test.rbinom <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(mean(rbinom(1000,100,0.5)), closeTo(49.98, DELTA))
	assertThat(mean(rbinom(1000,200,0.9)), closeTo(179.92, DELTA))
	assertThat(mean(rbinom(1000,250,0.12)), closeTo(29.91, DELTA))
}

test.rsignrank <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(mean(rsignrank(1000,10)), closeTo(27.568, DELTA))
}

test.rwilcox <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(mean(rwilcox(10000,4,5)), closeTo(10.02, DELTA))
}


test.rhyper <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(mean(rhyper(10000,17,16,13)), closeTo(6.3212, DELTA))
}


test.rnorm <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(mean(rnorm(10000,0,1)), closeTo(0.0, DELTA))
}


test.rgamma <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(rgamma(1,2,3), closeTo(1.282, DELTA))
}


test.rchisq <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(rchisq(1,6), closeTo(10.74, DELTA))
}


test.rexp <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(rexp(1,6), closeTo(0.021, DELTA))
}


test.rcauchy <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(rcauchy(1,8,6), closeTo(7.122, DELTA))
}


test.rlogis <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(rlogis(1,3,4), closeTo(13.32, DELTA))
}


test.rweibull <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(rweibull(1,4,3), closeTo(1.5592, DELTA))
}



test.rf <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(rf(1,5,7), closeTo(1.0, DELTA))
}


test.rbeta <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(rbeta(1,8,6), closeTo(0.3319, 0.1))
}


test.rpois <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(rgamma(1,8), closeTo(12.07, 0.1))
}


test.rgeom <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(rgeom(1,0.5), closeTo(0.0, 0.1))
}


test.rt <- function() {
	set.seed(12345, 'Mersenne-Twister','I')
	assertThat(rt(1,3), closeTo(3.28, 0.1));
}


test.rmultinom <- function() {
	set.seed(1234, 'Mersenne-Twister','I')
	assertThat(rmultinom(1,3,c(0.5,0.5)), equalTo(c(1,2)))
	assertThat(dim(rmultinom(20,3,c(0.5,0.3,0.2))), equalTo(c(3,20)))
}


test.randomSeedSetInGlobalEnv <- function() {
	.GlobalEnv$x <- 42
	runif(1)
	print(ls(envir=.GlobalEnv,all.names=T))
	get('.Random.seed', envir = .GlobalEnv, inherits = FALSE)
}